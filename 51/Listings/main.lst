C51 COMPILER V9.54   MAIN                                                                  05/30/2023 21:12:28 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.
                    -lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2           * @Author: isikveren lauxunzi@outlook.com
   3           * @Date: 2023-05-15 10:40:55
   4           * @LastEditors: isikveren lauxunzi@outlook.com
   5           * @LastEditTime: 2023-05-30 21:12:10
   6           * @FilePath: \51\main.c
   7           * @Description: DS1302时钟，
   8           */
   9          
  10          #include <REGX52.h>
  11          #include "delay.h"
  12          #include "Timer.h"
  13          #include "LCD1602.h"
  14          #include "DS1302.h"
  15          #include "key.h"
  16          
  17          unsigned char keynum, clock, mode, timeSetSelect = 0;
  18          void showtime(void);
  19          void settime(void);
  20          int main(void)
  21          {
  22   1          LCD_Init();
  23   1          DS1302_Init();
  24   1          DS1302_SetTime();
  25   1          LCD_ShowString(1, 1, "RTC");
  26   1          LCD_ShowString(1, 7, "20");
  27   1          LCD_ShowString(1, 9, "  -  -");
  28   1          LCD_ShowString(2, 9, "  :  :");
  29   1          while (1)
  30   1          {
  31   2              keynum = Key();
  32   2              if (keynum)
  33   2              {
  34   3                  LCD_ShowNum(2, 1, keynum, 2);
  35   3              }
  36   2              //  LCD_ShowNum(2, 1, keynum, 2);
  37   2              if (keynum == 1)
  38   2              {
  39   3                  if (mode == 0)
  40   3                  {
  41   4                      mode = 1;
  42   4                  }
  43   3                  else
  44   3                  {
  45   4                      mode = 0;
  46   4                  }
  47   3              }
  48   2              switch (mode)
  49   2              {
  50   3              case 0:
  51   3                  showtime();
  52   3                  break;
  53   3              case 1:
  54   3                  settime();
C51 COMPILER V9.54   MAIN                                                                  05/30/2023 21:12:28 PAGE 2   

  55   3                  break;
  56   3              }
  57   2          }
  58   1      }
  59          
  60          // void Timer0_Routine() interrupt 1
  61          // {
  62          
  63          //     TL0 = 0x18; // 设置定时初始值
  64          //     TH0 = 0xFC; // 设置定时初始值
  65          //     clock++;
  66          
  67          //     if (clock >= 1000)
  68          //     {
  69          
  70          //         clock = 0;
  71          //     }
  72          // }
  73          
  74          void showtime(void)
  75          {
  76   1          DS1302_ReadTime();
  77   1          LCD_ShowNum(1, 9, DS1302_Time[0], 2);
  78   1          LCD_ShowNum(1, 12, DS1302_Time[1], 2);
  79   1          LCD_ShowNum(1, 15, DS1302_Time[2], 2);
  80   1          LCD_ShowNum(2, 9, DS1302_Time[3], 2);
  81   1          LCD_ShowNum(2, 12, DS1302_Time[4], 2);
  82   1          LCD_ShowNum(2, 15, DS1302_Time[5], 2);
  83   1      }
  84          
  85          void settime(void)
  86          {
  87   1          if (keynum == 2)
  88   1          {
  89   2              timeSetSelect = timeSetSelect + 1;
  90   2              timeSetSelect %= 6;
  91   2          }
  92   1          if (keynum == 3)
  93   1          {
  94   2              DS1302_Time[timeSetSelect]++;
  95   2              if (DS1302_Time[0] > 99)
  96   2              {
  97   3                  DS1302_Time[0] = 0;
  98   3              }
  99   2              if (DS1302_Time[1] > 12)
 100   2              {
 101   3                  DS1302_Time[1] = 1;
 102   3              }
 103   2              if (DS1302_Time[1] == 1 || DS1302_Time[1] == 3 || DS1302_Time[1] == 5 || DS1302_Time[1] == 7 || DS
             -1302_Time[1] == 8 || DS1302_Time[1] == 10 || DS1302_Time[1] == 12)
 104   2              {
 105   3                  if (DS1302_Time[2] < 0)
 106   3                  {
 107   4                      DS1302_Time[2] = 31;
 108   4                  }
 109   3                  if (DS1302_Time[2] > 31)
 110   3                  {
 111   4                      DS1302_Time[2] = 1;
 112   4                  }
 113   3              }
 114   2              else if (DS1302_Time[1] == 2)
 115   2              {
C51 COMPILER V9.54   MAIN                                                                  05/30/2023 21:12:28 PAGE 3   

 116   3                  if (DS1302_Time[0] % 4 == 0)
 117   3                  {
 118   4                      if (DS1302_Time[2] < 1)
 119   4                      {
 120   5                          DS1302_Time[2] = 29;
 121   5                      }
 122   4                      if (DS1302_Time[2] > 29)
 123   4                      {
 124   5                          DS1302_Time[2] = 1;
 125   5                      }
 126   4                  }
 127   3                  else
 128   3                  {
 129   4                      if (DS1302_Time[2] < 1)
 130   4                      {
 131   5                          DS1302_Time[2] = 28;
 132   5                      }
 133   4                      if (DS1302_Time[2] > 28)
 134   4                      {
 135   5                          DS1302_Time[2] = 1;
 136   5                      }
 137   4                  }
 138   3              }
 139   2              else
 140   2              {
 141   3                  if (DS1302_Time[2] < 1)
 142   3                  {
 143   4                      DS1302_Time[2] = 30;
 144   4                  }
 145   3                  if (DS1302_Time[2] > 30)
 146   3                  {
 147   4                      DS1302_Time[2] = 1;
 148   4                  }
 149   3              }
 150   2      
 151   2              if (DS1302_Time[3] > 23)
 152   2              {
 153   3                  DS1302_Time[3] = 0;
 154   3              }
 155   2              if (DS1302_Time[4] > 59)
 156   2              {
 157   3                  DS1302_Time[4] = 0;
 158   3              }
 159   2              if (DS1302_Time[5] > 59)
 160   2              {
 161   3                  DS1302_Time[5] = 0;
 162   3              }
 163   2          }
 164   1          if (keynum == 4)
 165   1          {
 166   2              DS1302_Time[timeSetSelect]--;
 167   2      
 168   2              if (DS1302_Time[0] < 0)
 169   2              {
 170   3                  DS1302_Time[0] = 99;
 171   3              }
 172   2              if (DS1302_Time[1] < 1)
 173   2              {
 174   3                  DS1302_Time[1] = 12;
 175   3              }
 176   2              if (DS1302_Time[1] == 1 || DS1302_Time[1] == 3 || DS1302_Time[1] == 5 || DS1302_Time[1] == 7 || DS
             -1302_Time[1] == 8 || DS1302_Time[1] == 10 || DS1302_Time[1] == 12)
C51 COMPILER V9.54   MAIN                                                                  05/30/2023 21:12:28 PAGE 4   

 177   2              {
 178   3                  if (DS1302_Time[2] < 0)
 179   3                  {
 180   4                      DS1302_Time[2] = 31;
 181   4                  }
 182   3                  if (DS1302_Time[2] > 31)
 183   3                  {
 184   4                      DS1302_Time[2] = 1;
 185   4                  }
 186   3              }
 187   2              else if (DS1302_Time[1] == 2)
 188   2              {
 189   3                  if (DS1302_Time[0] % 4 == 0)
 190   3                  {
 191   4                      if (DS1302_Time[2] < 1)
 192   4                      {
 193   5                          DS1302_Time[2] = 29;
 194   5                      }
 195   4                      if (DS1302_Time[2] > 29)
 196   4                      {
 197   5                          DS1302_Time[2] = 1;
 198   5                      }
 199   4                  }
 200   3                  else
 201   3                  {
 202   4                      if (DS1302_Time[2] < 1)
 203   4                      {
 204   5                          DS1302_Time[2] = 28;
 205   5                      }
 206   4                      if (DS1302_Time[2] > 28)
 207   4                      {
 208   5                          DS1302_Time[2] = 1;
 209   5                      }
 210   4                  }
 211   3              }
 212   2              else
 213   2              {
 214   3                  if (DS1302_Time[2] < 1)
 215   3                  {
 216   4                      DS1302_Time[2] = 30;
 217   4                  }
 218   3                  if (DS1302_Time[2] > 30)
 219   3                  {
 220   4                      DS1302_Time[2] = 1;
 221   4                  }
 222   3              }
 223   2      
 224   2              if (DS1302_Time[3] < 0)
 225   2              {
 226   3                  DS1302_Time[3] = 23;
 227   3              }
 228   2              if (DS1302_Time[4] < 0)
 229   2              {
 230   3                  DS1302_Time[4] = 59;
 231   3              }
 232   2              if (DS1302_Time[5] < 0)
 233   2              {
 234   3                  DS1302_Time[5] = 59;
 235   3              }
 236   2          }
 237   1          LCD_ShowNum(2, 3, timeSetSelect, 2);
 238   1          LCD_ShowNum(1, 9, DS1302_Time[0], 2);
C51 COMPILER V9.54   MAIN                                                                  05/30/2023 21:12:28 PAGE 5   

 239   1          LCD_ShowNum(1, 12, DS1302_Time[1], 2);
 240   1          LCD_ShowNum(1, 15, DS1302_Time[2], 2);
 241   1          LCD_ShowNum(2, 9, DS1302_Time[3], 2);
 242   1          LCD_ShowNum(2, 12, DS1302_Time[4], 2);
 243   1          LCD_ShowNum(2, 15, DS1302_Time[5], 2);
 244   1          DS1302_SetTime();
 245   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    815    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
